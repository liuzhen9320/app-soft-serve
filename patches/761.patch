From b74035ac2601d97502864b2fc13f824dce56504a Mon Sep 17 00:00:00 2001
From: Jay Madden <25359755+Jay-Madden@users.noreply.github.com>
Date: Sun, 2 Nov 2025 15:10:08 -0600
Subject: [PATCH 1/4] feat: add commit and ref counters to tab view

---
 pkg/ui/components/tabs/tabs.go | 36 +++++++++++++++++++++++++++++-----
 pkg/ui/pages/repo/repo.go      | 23 +++++++++++++++++++---
 2 files changed, 51 insertions(+), 8 deletions(-)

diff --git a/pkg/ui/components/tabs/tabs.go b/pkg/ui/components/tabs/tabs.go
index 36f0a19e8..6069f1a1f 100644
--- a/pkg/ui/components/tabs/tabs.go
+++ b/pkg/ui/components/tabs/tabs.go
@@ -14,10 +14,22 @@ type SelectTabMsg int
 // ActiveTabMsg is a message that contains the index of the current active tab.
 type ActiveTabMsg int
 
+// IdentifiableTab is a struct that encapsulates a tabs shown value with an id.
+type IdentifiableTab struct {
+	ID    string
+	Value string
+}
+
+// SetTabValueMsg is a message that sets a tabs shown value.
+type SetTabValueMsg struct {
+	ID    string
+	Value string
+}
+
 // Tabs is bubbletea component that displays a list of tabs.
 type Tabs struct {
 	common       common.Common
-	tabs         []string
+	tabs         []IdentifiableTab
 	activeTab    int
 	TabSeparator lipgloss.Style
 	TabInactive  lipgloss.Style
@@ -28,9 +40,16 @@ type Tabs struct {
 
 // New creates a new Tabs component.
 func New(c common.Common, tabs []string) *Tabs {
+	ts := make([]IdentifiableTab, 0)
+	for _, t := range tabs {
+		ts = append(ts, IdentifiableTab{
+			ID:    t,
+			Value: t,
+		})
+	}
 	r := &Tabs{
 		common:       c,
-		tabs:         tabs,
+		tabs:         ts,
 		activeTab:    0,
 		TabSeparator: c.Styles.TabSeparator,
 		TabInactive:  c.Styles.TabInactive,
@@ -67,12 +86,19 @@ func (t *Tabs) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
 		switch msg.Button {
 		case tea.MouseLeft:
 			for i, tab := range t.tabs {
-				if t.common.Zone.Get(tab).InBounds(msg) {
+				if t.common.Zone.Get(tab.ID).InBounds(msg) {
 					t.activeTab = i
 					cmds = append(cmds, t.activeTabCmd)
 				}
 			}
 		}
+	case SetTabValueMsg:
+		for i, tab := range t.tabs {
+			if tab.ID == msg.ID {
+				t.tabs[i].Value = msg.Value
+				break
+			}
+		}
 	case SelectTabMsg:
 		tab := int(msg)
 		if tab >= 0 && tab < len(t.tabs) {
@@ -98,8 +124,8 @@ func (t *Tabs) View() string {
 		}
 		s.WriteString(
 			t.common.Zone.Mark(
-				tab,
-				style.Render(tab),
+				tab.ID,
+				style.Render(tab.Value),
 			),
 		)
 		if i != len(t.tabs)-1 {
diff --git a/pkg/ui/pages/repo/repo.go b/pkg/ui/pages/repo/repo.go
index e9e5535ee..e52ec07ea 100644
--- a/pkg/ui/pages/repo/repo.go
+++ b/pkg/ui/pages/repo/repo.go
@@ -68,7 +68,7 @@ func New(c common.Common, comps ...common.TabComponent) *Repo {
 		ts = append(ts, c.TabName())
 	}
 	c.Logger = c.Logger.WithPrefix("ui.repo")
-	tb := tabs.New(c, ts)
+	tb := tabs.NewTabs(c, ts)
 	// Make sure the order matches the order of tab constants above.
 	s := spinner.New(spinner.WithSpinner(spinner.Dot),
 		spinner.WithStyle(c.Styles.Spinner))
@@ -216,10 +216,27 @@ func (r *Repo) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
 		cmds = append(cmds, r.updateTabComponent(&Readme{}, msg))
 	case FileItemsMsg, FileContentMsg:
 		cmds = append(cmds, r.updateTabComponent(&Files{}, msg))
+	case LogCommitMsg:
 	case LogItemsMsg, LogDiffMsg, LogCountMsg:
-		cmds = append(cmds, r.updateTabComponent(&Log{}, msg))
+		log := &Log{}
+		if lcm, ok := msg.(LogCountMsg); ok {
+			msg := tabs.SetTabValueMsg{ID: log.TabName(), Value: fmt.Sprintf("Commits (%d)", int64(lcm))}
+			t, cmd := r.tabs.Update(msg)
+			r.tabs = t.(*tabs.Tabs)
+			if cmd != nil {
+				cmds = append(cmds, cmd)
+			}
+		}
+		cmds = append(cmds, r.updateTabComponent(log, msg))
 	case RefItemsMsg:
-		cmds = append(cmds, r.updateTabComponent(&Refs{refPrefix: msg.prefix}, msg))
+		refs := &Refs{refPrefix: msg.prefix}
+		tabMsg := tabs.SetTabValueMsg{ID: refs.TabName(), Value: fmt.Sprintf("%s (%d)", refs.TabName(), len(msg.items))}
+		t, cmd := r.tabs.Update(tabMsg)
+		r.tabs = t.(*tabs.Tabs)
+		if cmd != nil {
+			cmds = append(cmds, cmd)
+		}
+		cmds = append(cmds, r.updateTabComponent(refs, msg))
 	case StashListMsg, StashPatchMsg:
 		cmds = append(cmds, r.updateTabComponent(&Stash{}, msg))
 	// We have two spinners, one is used to when loading the repository and the

From a1e967534067fff1504615981296339fddefdb81 Mon Sep 17 00:00:00 2001
From: Jay Madden <25359755+Jay-Madden@users.noreply.github.com>
Date: Sun, 2 Nov 2025 15:17:06 -0600
Subject: [PATCH 2/4] fix: switch to logitemsmsg

---
 pkg/ui/pages/repo/repo.go | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/pkg/ui/pages/repo/repo.go b/pkg/ui/pages/repo/repo.go
index e52ec07ea..a0b5483a4 100644
--- a/pkg/ui/pages/repo/repo.go
+++ b/pkg/ui/pages/repo/repo.go
@@ -68,7 +68,7 @@ func New(c common.Common, comps ...common.TabComponent) *Repo {
 		ts = append(ts, c.TabName())
 	}
 	c.Logger = c.Logger.WithPrefix("ui.repo")
-	tb := tabs.NewTabs(c, ts)
+	tb := tabs.New(c, ts)
 	// Make sure the order matches the order of tab constants above.
 	s := spinner.New(spinner.WithSpinner(spinner.Dot),
 		spinner.WithStyle(c.Styles.Spinner))
@@ -219,8 +219,8 @@ func (r *Repo) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
 	case LogCommitMsg:
 	case LogItemsMsg, LogDiffMsg, LogCountMsg:
 		log := &Log{}
-		if lcm, ok := msg.(LogCountMsg); ok {
-			msg := tabs.SetTabValueMsg{ID: log.TabName(), Value: fmt.Sprintf("Commits (%d)", int64(lcm))}
+		if lim, ok := msg.(LogItemsMsg); ok {
+			msg := tabs.SetTabValueMsg{ID: log.TabName(), Value: fmt.Sprintf("Commits (%d)", len(lim))}
 			t, cmd := r.tabs.Update(msg)
 			r.tabs = t.(*tabs.Tabs)
 			if cmd != nil {

From e431188ca8f18df3a9a1fe89ffd20cbc865f8740 Mon Sep 17 00:00:00 2001
From: Jay Madden <25359755+Jay-Madden@users.noreply.github.com>
Date: Sun, 2 Nov 2025 15:18:00 -0600
Subject: [PATCH 3/4] chore: remove lcm line

---
 pkg/ui/pages/repo/repo.go | 1 -
 1 file changed, 1 deletion(-)

diff --git a/pkg/ui/pages/repo/repo.go b/pkg/ui/pages/repo/repo.go
index a0b5483a4..9137f3a05 100644
--- a/pkg/ui/pages/repo/repo.go
+++ b/pkg/ui/pages/repo/repo.go
@@ -216,7 +216,6 @@ func (r *Repo) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
 		cmds = append(cmds, r.updateTabComponent(&Readme{}, msg))
 	case FileItemsMsg, FileContentMsg:
 		cmds = append(cmds, r.updateTabComponent(&Files{}, msg))
-	case LogCommitMsg:
 	case LogItemsMsg, LogDiffMsg, LogCountMsg:
 		log := &Log{}
 		if lim, ok := msg.(LogItemsMsg); ok {

From b05d1be732d1f751eb87966fa4368963265d7744 Mon Sep 17 00:00:00 2001
From: Jay Madden <25359755+Jay-Madden@users.noreply.github.com>
Date: Sun, 2 Nov 2025 15:40:37 -0600
Subject: [PATCH 4/4] fix: reset tab names when repo navigation happens

---
 pkg/ui/components/tabs/tabs.go | 7 +++++++
 pkg/ui/pages/repo/repo.go      | 3 +++
 2 files changed, 10 insertions(+)

diff --git a/pkg/ui/components/tabs/tabs.go b/pkg/ui/components/tabs/tabs.go
index 6069f1a1f..54589917a 100644
--- a/pkg/ui/components/tabs/tabs.go
+++ b/pkg/ui/components/tabs/tabs.go
@@ -108,6 +108,13 @@ func (t *Tabs) Update(msg tea.Msg) (tea.Model, tea.Cmd) {
 	return t, tea.Batch(cmds...)
 }
 
+// ResetTabNames resets all tab names to their IDs.
+func (t *Tabs) ResetTabNames() {
+	for i := range t.tabs {
+		t.tabs[i].Value = t.tabs[i].ID
+	}
+}
+
 // View implements tea.Model.
 func (t *Tabs) View() string {
 	s := strings.Builder{}
diff --git a/pkg/ui/pages/repo/repo.go b/pkg/ui/pages/repo/repo.go
index 9137f3a05..47c863521 100644
--- a/pkg/ui/pages/repo/repo.go
+++ b/pkg/ui/pages/repo/repo.go
@@ -139,6 +139,9 @@ func (r *Repo) FullHelp() [][]key.Binding {
 func (r *Repo) Init() tea.Cmd {
 	r.state = loadingState
 	r.activeTab = 0
+	// Reset the tab names on every init so that we do not
+	// briefly show incorrect counts when navigating between repos
+	r.tabs.ResetTabNames()
 	return tea.Batch(
 		r.tabs.Init(),
 		r.statusbar.Init(),
